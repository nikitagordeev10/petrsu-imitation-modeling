Функция PI()
    Возврат 3.1415926535897932384626433832795;
КонецФункции

Функция Abs(Аргумент) 
    Возврат ?(Аргумент >= 0, Аргумент, -Аргумент);
КонецФункции


// Функция для генерации случайного числа из распределения Пуассона
Функция ПуассонСлучайноеЧисло(lambda)
    k = 0;
    L = EXP(-lambda);
    p = 1.0;
	
	ГСЧ = Новый ГенераторСлучайныхЧисел();
	Пока p > L Цикл
        k = k + 1;
        p = p * (ГСЧ.СлучайноеЧисло(0, 1000000) / 1000000.0);
    КонецЦикла;
    Возврат k - 1;
КонецФункции

// Функция для вычисления вероятности срабатывания схемы
Процедура ВычислитьВероятностьСрабатывания(D, simulations)
    C = 299792458; // Скорость света
    delta_t = 0.00000003; // Временной интервал
    lambda = 2.0; // Параметр распределения Пуассона
    success_count = 0;
    ГСЧ = Новый ГенераторСлучайныхЧисел();
	
    Для sim = 1 По simulations Цикл
        N = ПуассонСлучайноеЧисло(lambda) + 1;
        times = Новый Массив(100);

        Для i = 1 По N Цикл
            x = (ГСЧ.СлучайноеЧисло(0, 1000000) / 1000000.0) * D;
            theta = ACOS(1 - 2 * (ГСЧ.СлучайноеЧисло(0, 1000000) / 1000000.0));
            times[i - 1] = x / (C * COS(theta));
        КонецЦикла;

        Для i = 1 По N - 1 Цикл
            Для j = i + 1 По N Цикл
                Если ABS(times[i - 1] - times[j - 1]) <= delta_t Тогда
                    success_count = success_count + 1;
                    Прервать;
                КонецЕсли;
            КонецЦикла;
        КонецЦикла;
    КонецЦикла;

    probability = success_count / simulations;
    Сообщить("Вероятность срабатывания схемы: " + probability);
КонецПроцедуры

&НаКлиенте
Процедура Сгенерировать(Команда)
	// Параметры программы
    D = 1.0; // Толщина слоя (м)
    simulations = 10000; // Количество симуляций

    // Вызов функции вычисления вероятности
    ВычислитьВероятностьСрабатывания(D, simulations);
КонецПроцедуры