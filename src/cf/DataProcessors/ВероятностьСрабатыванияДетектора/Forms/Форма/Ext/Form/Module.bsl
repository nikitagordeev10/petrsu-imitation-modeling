Функция ГенерацияПуассона(лямбда)
    L = Exp(-лямбда)
    k = 0;
    p = 1;
    Пока p > L Цикл
        k = k + 1;
        u = СлучайноеЧисло(0, 1);
        p = p * u;
    КонецЦикла;
    Возврат k - 1;
КонецФункции

Функция ГенерацияРавномерногоУгла()
    Возврат СлучайноеЧисло(0, 2 * Пи());
КонецФункции

Функция ВычислитьВремяПролета(углы, D, C)
    времяПролета = Новый Массив;
    Для каждого угол Из углы Цикл
        время = (D / 2) / (C * Abs(Sin(угол)));
        времяПролета.Добавить(время);
    КонецЦикла;
    Возврат времяПролета;
КонецФункции

Функция ВычислитьРазностиВремен(времяПролета)
    разности = Новый Массив;
    Для i = 1 По времяПролета.Количество() - 1 Цикл
        разность = времяПролета[i] - времяПролета[i - 1];
        разности.Добавить(разность);
    КонецЦикла;
    Возврат разности;
КонецФункции

Функция ОценитьВероятностьСрабатывания(лямбда, D, C, delta_t, num_trials)
    вероятности = Новый Массив;
    Для i = 1 По num_trials Цикл
        N = ГенерацияПуассона(лямбда);
        Если N = 0 Тогда
            вероятности.Добавить(0);
            Продолжить;
        КонецЕсли;

        углы = Новый Массив;
        Для j = 1 По N + 1 Цикл
            углы.Добавить(ГенерацияРавномерногоУгла());
        КонецЦикла;

        времяПролета = ВычислитьВремяПролета(углы, D, C);
        времяПролета.Сортировать();

        разности = ВычислитьРазностиВремен(времяПролета);

        совпадения = 0;
        Для каждого разность Из разности Цикл
            Если разность < delta_t Тогда
                совпадения = совпадения + 1;
            КонецЕсли;
        КонецЦикла;

        вероятность = совпадения / разности.Количество();
        вероятности.Добавить(вероятность);
    КонецЦикла;

    средняяВероятность = СреднееЗначение(вероятности);
    Возврат средняяВероятность;
КонецФункции

&НаКлиенте
Процедура Сгенерировать(Команда)
	// Параметры задачи
	лямбда = 2;          // Параметр Пуассона
	D = 5;               // Толщина слоя, м
	C = 3e8;             // Скорость света, м/с
	delta_t = 3e-8;      // Пороговое время для совпадений
	num_trials = 1000;   // Количество симуляций

	// Оценка вероятности срабатывания схемы
	средняяВероятность = ОценитьВероятностьСрабатывания(лямбда, D, C, delta_t, num_trials);
	Сообщить("Оценочная вероятность срабатывания схемы: " + Формат(средняяВероятность, "ЧГ=6"));
КонецПроцедуры


