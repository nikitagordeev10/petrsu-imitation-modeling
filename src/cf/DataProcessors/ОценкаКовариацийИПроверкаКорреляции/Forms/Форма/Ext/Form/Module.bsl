Функция PI()
    Возврат 3.1415926535897932384626433832795;
КонецФункции

Функция Abs(Аргумент) 
    Возврат ?(Аргумент >= 0, Аргумент, -Аргумент);
КонецФункции


Процедура РазложениеХолецкого(МассивКовариации, МассивL, n)
    Для i = 0 По n - 1 Цикл
        Для j = 0 По i Цикл
            Сумма = 0;
            Для k = 0 По j - 1 Цикл
                Сумма = Сумма + МассивL[i][k] * МассивL[j][k];
            КонецЦикла;
            Если i = j Тогда
                МассивL[i][j] = SQRT(МассивКовариации[i][i] - Сумма);
            Иначе
                МассивL[i][j] = (МассивКовариации[i][j] - Сумма) / МассивL[j][j];
            КонецЕсли;
        КонецЦикла;
    КонецЦикла;
КонецПроцедуры

Процедура ГенерацияМногомерногоНормальногоРаспределения(n, КоличествоОбразцов, МассивСредних, МассивКовариации, МассивОбразцов)
	ГСЧ = Новый ГенераторСлучайныхЧисел();
	МассивL = Новый Массив(n, n);
    РазложениеХолецкого(МассивКовариации, МассивL, n);
    
    Для k = 0 По КоличествоОбразцов - 1 Цикл
        z = Новый Массив(n);
        Для i = 0 По n - 1 Цикл
			z[i] = SQRT(-2 * Log(Макс(ГСЧ.СлучайноеЧисло(0, 1), 0.000001))) * COS(2 * PI() * ГСЧ.СлучайноеЧисло(0, 1));
        КонецЦикла;
        Для i = 0 По n - 1 Цикл
            МассивОбразцов[k][i] = МассивСредних[i];
            Для j = 0 По i Цикл
                МассивОбразцов[k][i] = МассивОбразцов[k][i] + МассивL[i][j] * z[j];
            КонецЦикла;
        КонецЦикла;
    КонецЦикла;
КонецПроцедуры

Процедура ВычислениеМатрицыКовариации(n, КоличествоОбразцов, МассивОбразцов, МассивКовариацииОценка)
    МассивСреднихОценка = Новый Массив(n);
    Для j = 0 По n - 1 Цикл
        МассивСреднихОценка[j] = 0;
    КонецЦикла;
    
    Для i = 0 По КоличествоОбразцов - 1 Цикл
        Для j = 0 По n - 1 Цикл
            МассивСреднихОценка[j] = МассивСреднихОценка[j] + МассивОбразцов[i][j];
        КонецЦикла;
    КонецЦикла;
    Для j = 0 По n - 1 Цикл
        МассивСреднихОценка[j] = МассивСреднихОценка[j] / КоличествоОбразцов;
    КонецЦикла;
    
    Для i = 0 По n - 1 Цикл
        Для j = 0 По n - 1 Цикл
            МассивКовариацииОценка[i][j] = 0;
            Для k = 0 По КоличествоОбразцов - 1 Цикл
                МассивКовариацииОценка[i][j] = МассивКовариацииОценка[i][j] + (МассивОбразцов[k][i] - МассивСреднихОценка[i]) * (МассивОбразцов[k][j] - МассивСреднихОценка[j]);
            КонецЦикла;
            МассивКовариацииОценка[i][j] = МассивКовариацииОценка[i][j] / (КоличествоОбразцов - 1);
        КонецЦикла;
    КонецЦикла;
КонецПроцедуры

Процедура ПроверкаГипотезыОКорреляции(n, КоличествоОбразцов, МассивКовариацииОценка, i, j, rho_0)
    r = МассивКовариацииОценка[i][j] / SQRT(МассивКовариацииОценка[i][i] * МассивКовариацииОценка[j][j]);
    t_stat = r * SQRT((КоличествоОбразцов - 2) / (1 - r * r));
    Сообщить("Оценка корреляции между X[" + i + "] и X[" + j + "]: " + r);
    Сообщить("Статистика теста t: " + t_stat);
    Сообщить("Критическое значение (для 0.05): примерно 1.96");
    Если Abs(t_stat) < 1.96 Тогда
        Сообщить("Гипотеза не отвергается (коэффициент корреляции равен " + rho_0 + ").");
    Иначе
        Сообщить("Гипотеза отвергается (коэффициент корреляции не равен " + rho_0 + ").");
    КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура Сгенерировать(Команда)
    n = 3;
    КоличествоОбразцов = 1000;
    
    МассивСредних = Новый Массив(n);
    МассивСредних[0] = 0;
    МассивСредних[1] = 0;
    МассивСредних[2] = 0;
    
    МассивКовариации = Новый Массив(n, n);
    МассивКовариации[0][0] = 1.0;
    МассивКовариации[0][1] = 0.5;
    МассивКовариации[0][2] = 0.2;
    МассивКовариации[1][0] = 0.5;
    МассивКовариации[1][1] = 1.0;
    МассивКовариации[1][2] = 0.3;
    МассивКовариации[2][0] = 0.2;
    МассивКовариации[2][1] = 0.3;
    МассивКовариации[2][2] = 1.0;
    
    МассивОбразцов = Новый Массив(КоличествоОбразцов, n);
    МассивКовариацииОценка = Новый Массив(n, n);
    
    ГенерацияМногомерногоНормальногоРаспределения(n, КоличествоОбразцов, МассивСредних, МассивКовариации, МассивОбразцов);
    ВычислениеМатрицыКовариации(n, КоличествоОбразцов, МассивОбразцов, МассивКовариацииОценка);
    
    i = 0;
    j = 1;
    rho_0 = 0.5;
    ПроверкаГипотезыОКорреляции(n, КоличествоОбразцов, МассивКовариацииОценка, i, j, rho_0);
КонецПроцедуры