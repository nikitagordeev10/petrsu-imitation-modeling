// Функция генерации стандартного нормального распределения
Функция НормальноеСлучайноеЧисло()          
	ГСЧ = Новый ГенераторСлучайныхЧисел();
    u1 = ГСЧ.СлучайноеЧисло(0, 1000000) / 1000000.0;
    u2 = ГСЧ.СлучайноеЧисло(0, 1000000) / 1000000.0;
    Возврат sqrt(-2.0 * log(u1)) * COS(2.0 * 3.141592653589793 * u2);
КонецФункции

// Функция моделирования стоимости портфеля
Процедура МоделироватьПортфель(m, simulations, T, alpha, S0, mu, sigma, n)
	//Процедура МоделироватьПортфель(m, simulations, T, alpha)
	//S0 = Новый Массив(m);
	//mu = Новый Массив(m);
	//sigma = Новый Массив(m);
	//n = Новый Массив(m);
    
	//Для i = 0 По m - 1 Цикл
	//    Сообщить("Введите начальную стоимость, средний рост и волатильность для бумаги " + (i + 1) + ":");
	//    S0[i] = ВвестиЧисло("Начальная стоимость: ");
	//    mu[i] = ВвестиЧисло("Средний рост: ");
	//    sigma[i] = ВвестиЧисло("Волатильность: ");
	//    Сообщить("Введите количество ценных бумаг " + (i + 1) + " в портфеле:");
	//    n[i] = ВвестиЧисло("Количество: ");
	//КонецЦикла;   
	
    
    V0 = 0.0;
    Для i = 0 По m - 1 Цикл
        V0 = V0 + n[i] * S0[i];
    КонецЦикла;
    
    LT = Новый Массив(simulations);
    
    Для j = 0 По simulations - 1 Цикл
        VT = 0.0;
        Для i = 0 По m - 1 Цикл
            Z = НормальноеСлучайноеЧисло();
            ST = S0[i] * EXP((mu[i] - 0.5 * sigma[i] * sigma[i]) * T + sigma[i] * sqrt(T) * Z);
            VT = VT + n[i] * ST;
        КонецЦикла;
        LT[j] = V0 - VT;
    КонецЦикла;
    
    // Сортировка потерь для вычисления квантиля
    Для i = 0 По simulations - 2 Цикл
        Для j = 0 По simulations - i - 2 Цикл
            Если LT[j] > LT[j + 1] Тогда
                temp = LT[j];
                LT[j] = LT[j + 1];
                LT[j + 1] = temp;
            КонецЕсли;
        КонецЦикла;
    КонецЦикла;
    
    index = ЦЕЛ(simulations * alpha);
    VR = LT[index];
    
    Сообщить("Value at Risk (VaR) на уровне доверия " + (1 - alpha) + ": " + VR);
КонецПроцедуры

&НаКлиенте
Процедура Сгенерировать(Команда)
	//m = 0;
	//simulations = 0;
	//T = 0.0;
	//alpha = 0.0;
    
	//Сообщить("Введите количество видов ценных бумаг:");
	//m = ВвестиЧисло("Количество: ");
	//Сообщить("Введите период инвестирования (T):");
	//T = ВвестиЧисло("Период: ");
	//Сообщить("Введите количество симуляций:");
	//simulations = ВвестиЧисло("Симуляции: ");
	//Сообщить("Введите уровень доверия (например, 0.95):");
	//alpha = ВвестиЧисло("Уровень доверия: ");              
	
    // Параметры программы
    m = 2; // Количество видов ценных бумаг
    simulations = 1000; // Количество симуляций
    T = 1.0; // Период инвестирования
    alpha = 0.05; // Уровень доверия (95%)
    
    // Начальные данные для ценных бумаг
    S0 = Новый Массив(2);
    S0[0] = 100.0; // Начальная стоимость для бумаги 1
    S0[1] = 50.0;  // Начальная стоимость для бумаги 2
    
    mu = Новый Массив(2);
    mu[0] = 0.05; // Средний рост для бумаги 1
    mu[1] = 0.03; // Средний рост для бумаги 2
    
    sigma = Новый Массив(2);
    sigma[0] = 0.2;  // Волатильность для бумаги 1
    sigma[1] = 0.15; // Волатильность для бумаги 2
    
    n = Новый Массив(2);
    n[0] = 10; // Количество бумаг 1 в портфеле
    n[1] = 20; // Количество бумаг 2 в портфеле
    
    // Вызов функции моделирования
    МоделироватьПортфель(m, simulations, T, alpha, S0, mu, sigma, n);
	
	//МоделироватьПортфель(m, simulations, T, alpha);
КонецПроцедуры